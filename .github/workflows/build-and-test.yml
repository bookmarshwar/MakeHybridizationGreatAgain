name: Build with Java 17 Override

on:
  pull_request:
    branches: [master, main]
  push:
    branches: [master, main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    # 首先设置 Java 17，然后运行原工作流
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      # 强制设置 Java 17
      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          
      # 手动下载并运行原工作流的内容
      # 或者直接运行构建命令
      - name: Clone GTNH workflows
        run: |
          git clone --depth 1 https://github.com/GTNewHorizons/GTNH-Actions-Workflows.git /tmp/gtnh-workflows
          
      - name: Execute build steps
        run: |
          # 这里可以运行原工作流中的具体步骤
          chmod +x gradlew
          ./gradlew clean build
          
      # 运行测试
      - name: Run tests
        run: |
          if [ -f ".gtnh-workflows/scripts/test_no_error_reports" ]; then
            .gtnh-workflows/scripts/test_no_error_reports
          fi
